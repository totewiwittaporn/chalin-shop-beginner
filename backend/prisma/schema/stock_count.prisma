model StockCount {
  id                   Int              @id @default(autoincrement())
  scope                StockCountScope
  branchId             Int?
  consignmentPartnerId Int?
  code                 String?
  notes                String?
  status               StockCountStatus @default(OPEN)
  startedAt            DateTime
  finalizedAt          DateTime?

  branch             Branch?             @relation(fields: [branchId], references: [id])
  consignmentPartner ConsignmentPartner? @relation(fields: [consignmentPartnerId], references: [id])
  lines              StockCountLine[]

  @@index([scope, status])
  @@index([branchId])
  @@index([consignmentPartnerId])
}

model StockCountLine {
  id           Int @id @default(autoincrement())
  stockCountId Int
  productId    Int
  systemQty    Int @default(0)
  countedQty   Int @default(0)
  delta        Int @default(0)

  stockCount StockCount @relation(fields: [stockCountId], references: [id])
  product    Product    @relation(fields: [productId], references: [id])

  @@unique([stockCountId, productId])
  @@index([productId])
}
