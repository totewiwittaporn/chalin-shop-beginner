// prisma/schema/sales.prisma

model Sale {
  id        Int      @id @default(autoincrement())
  code      String?  @unique
  branchId  Int
  date      DateTime @default(now())
  note      String?
  status    String   @default("DRAFT") // DRAFT | PAID | CANCELLED
  subtotal  Decimal  @default(0) @db.Decimal(12, 2)
  discount  Decimal  @default(0) @db.Decimal(12, 2)
  total     Decimal  @default(0) @db.Decimal(12, 2)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branch   Branch     @relation(fields: [branchId], references: [id])
  items    SaleItem[]
  payments Payment[]

  @@index([branchId])
  @@index([status])
  @@index([date])
}

model SaleItem {
  id          Int     @id @default(autoincrement())
  saleId      Int
  productId   Int
  productName String
  qty         Int
  unitPrice   Decimal @db.Decimal(12, 2)
  lineTotal   Decimal @db.Decimal(12, 2)

  sale    Sale    @relation(fields: [saleId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@index([saleId])
  @@index([productId])
}

model Payment {
  id          Int           @id @default(autoincrement())
  saleId      Int
  method      PaymentMethod
  amount      Decimal       @db.Decimal(12, 2)
  evidenceUrl String?
  createdAt   DateTime      @default(now())

  sale Sale @relation(fields: [saleId], references: [id])

  @@index([saleId])
  @@index([method])
}
